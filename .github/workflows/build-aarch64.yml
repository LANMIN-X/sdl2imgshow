name: Manual Build AArch64

on:
  workflow_dispatch:

jobs:
  build-aarch64:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      - name: Build inside Debian 10 ARM64 (glibc 2.28)
        uses: uraimo/run-on-arch-action@v2.7.1
        with:
          arch: aarch64
          distro: debian_buster
          run: |
            apt-get update
            apt-get install -y \
              cmake build-essential \
              libsdl2-dev libsdl2-image-dev libsdl2-ttf-dev
            cmake -Bbuild -DCMAKE_BUILD_TYPE=RelWithDebInfo
            cmake --build build -j4

      - name: Generate tag
        id: tag
        run: echo "tag=aarch64-$(date +'%Y%m%d-%H%M%S')" >> $GITHUB_OUTPUT

      - name: Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.tag.outputs.tag }}
          files: build/sdl2imgshow
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
